# Static Proxies

## Static Proxies
- Static proxies mean the **interfaces and the classes on which proxies are applied are fixed / well-known at development time**.

---

## Example for Static Proxies

### Interface
```java
interface IA {
    public void m1();
}
````

### Original Class

```java
public class A implements IA {
    public void m1() {
    }
}
```

### Static Proxy

```java
public class Logging implements IA {

    IA a;

    public void m1() {
        // log message
        a.m1();
        // log message
    }
}
```

---

# Runtime Proxies

## Runtime Proxies

* Runtime proxies are used to **apply additional functionality dynamically**.
* The class on top of which additional functionality is applied **may not be known at development time**.
* In Java, runtime proxy generation is done using libraries like:

  * **Javassist**
  * **CGLIB**

---

## Example for Runtime Proxy

### Interface

```java
interface IA {
    public void m1();
}
```

### Original Class

```java
public class A implements IA {
    public void m1() {
    }
}
```

### Invocation Handler (Additional Functionality)

```java
class Logging implements InvocationHandler {

    public Object invoke(Method method, Object[] args, Class<?> proxy) {
        // call original class method
        // add logging logic
        return null;
    }
}
```

---

## JVM Runtime Proxy Creation

```java
Object proxy = ProxyFactory.newProxy(IA.class, Logging);
```

### Runtime Proxy (Generated by JVM)

```java
class IAProxy implements IA {

    IA a;

    public void m1() {
        // runtime calls InvocationHandler.invoke()
    }
}
```

---

# Spring Data JPA and Runtime Proxies

## Entity Example: Bike

```java
@Entity
@Table(name = "bike")
public class Bike {

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    @Column(name = "bike_no")
    protected int bikeNo;

    @Column(name = "bike_name")
    protected String bikeName;

    @Column(name = "bike_color")
    protected String bikeColor;

    @Column(name = "bike_model")
    protected String bikeModel;

    // accessor methods
}
```

---

## Entity Example: Staff

```java
@Entity
@Table(name = "staff")
public class Staff {

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    @Column(name = "staff_no")
    protected int staffNo;

    protected String firstName;
    protected String lastName;
    protected int age;
    protected String gender;
    protected String designation;
    protected String mobileNo;
    protected String emailAddress;

    // accessor methods
}
```

---

## Spring Data JPA – Internal InvocationHandler

```java
class PersistInvocationHandler implements InvocationHandler {

    EntityManager entityManager;

    public Object invoke(Method method, Object[] args, Class<?> proxy) {
        entityManager.persist(args[0]);
        Class<?> entityClass = args[0].getClass();
        // get the @Id property value
        return args[0].getId();
    }
}
```

---

## Repository Example

```java
interface ProductRepository<Integer, Product> {
    Integer save(Product product);
}
```

```java
class ProductService {

    @Autowired
    private ProductRepository productRepository;

    public void saveProduct(Product p1) {
        productRepository.save(p1);
    }
}
```

---

## Explanation

* Every DAO usually contains the same methods:

  * `save`
  * `update`
  * `delete`
  * `get`
* Spring Data JPA already knows the logic for these methods.
* Internally, Spring Data JPA creates **one InvocationHandler** with predefined logic.

### Runtime Proxy Creation by Spring IOC Container

```java
Object proxy =
    ProxyFactory.newProxy(ProductRepository.class, PersistInvocationHandler);
```

### Generated Proxy Class

```java
class ProductRepositoryProxy implements ProductRepository {

    public int save(Product product) {
        // call PersistInvocationHandler.invoke()
        return 0;
    }
}
```

---

## Repository Hierarchy in Spring Data JPA

```java
interface Repository<T, ID> {
}
```

```java
interface CrudRepository<T, ID> extends Repository<T, ID> {
    T save(T t);
    T findById(ID id);
    Iterable<T> findAll();
    long count();
    void delete(T entity);
    boolean existsById(ID id);
}
```

```java
interface JpaRepository<T, ID> extends CrudRepository<T, ID> {
}
```

```java
interface PagingAndSortingRepository<T, ID>
        extends CrudRepository<T, ID> {

    Iterable<T> findAll(Sort sort);
    Page<T> findAll(Pageable pageable);
}
```

---

## Generic Parameters

* `T` → Entity class
* `ID` → Primary key type of the entity

---

## Key Notes

* Spring Data Module provides **technology-specific repositories**.
* `@EnableJpaRepositories` annotation instructs Spring to create **JPA repository runtime proxies**.
* Similar annotations exist for other technologies:

  * `@EnableMongoRepositories`
  * `@EnableCassandraRepositories`
* If no explicit annotation is provided, Spring IOC Container will not create runtime proxies automatically.


```
```
